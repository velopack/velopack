<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFrameworks>net472;net6.0</TargetFrameworks>
    <Nullable>enable</Nullable>
    <LangVersion>12</LangVersion>
    <!-- 
    https://learn.microsoft.com/dotnet/core/project-sdk/msbuild-props?WT.mc_id=DT-MVP-5003472#copylocallockfileassemblies
    -->
    <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="..\Velopack.Packaging.Unix\Velopack.Packaging.Unix.csproj" />
    <ProjectReference Include="..\Velopack.Packaging.Windows\Velopack.Packaging.Windows.csproj" />
    <ProjectReference Include="..\Velopack\Velopack.csproj" />
  </ItemGroup>

  <PropertyGroup>
  </PropertyGroup>

  <PropertyGroup Label="MacOS" Condition="$([System.OperatingSystem]::IsMacOS())">
    <VelopackRustOutputDirectory>..\Rust\target</VelopackRustOutputDirectory>
    <VelopackUpdateExe>UpdateMac</VelopackUpdateExe>
  </PropertyGroup>

  <ItemGroup Condition="$([System.OperatingSystem]::IsMacOS())">
    <None Include="..\Rust\target\$(VelopackUpdateExe)" Link="$(VelopackUpdateExe)" Visible="false">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>

  <PropertyGroup Label="Linux" Condition="$([System.OperatingSystem]::IsLinux())">
    <VelopackRustOutputDirectory>..\Rust\target</VelopackRustOutputDirectory>
    <VelopackUpdateExe>UpdateNix</VelopackUpdateExe>
  </PropertyGroup>

  <ItemGroup Condition="$([System.OperatingSystem]::IsMacOS())">
    <None Include="..\Rust\target\$(VelopackUpdateExe)" Link="$(VelopackUpdateExe)" Visible="false">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>

  <PropertyGroup Label="Windows" Condition="$([System.OperatingSystem]::IsWindows())">
    <VelopackRustOutputDirectory>..\Rust\target\$(Configuration.ToLower())</VelopackRustOutputDirectory>
    <VelopackUpdateExe>update.exe</VelopackUpdateExe>
    <VelopackStubExe>stub.exe</VelopackStubExe>
    <VelopackSetupExe>setup.exe</VelopackSetupExe>
  </PropertyGroup>

  <ItemGroup Condition="$([System.OperatingSystem]::IsWindows())">
    <None Include="..\Rust\target\$(Configuration.ToLower())\$(VelopackUpdateExe)" Link="$(VelopackUpdateExe)" Visible="false">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
    <None Include="..\Rust\target\$(Configuration.ToLower())\$(VelopackStubExe)" Link="$(VelopackStubExe)" Visible="false">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
    <None Include="..\Rust\target\$(Configuration.ToLower())\$(VelopackSetupExe)" Link="$(VelopackSetupExe)" Visible="false">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>

    <None Include="..\..\vendor\rcedit.exe" Link="rcedit.exe" Visible="false" Condition="$([System.OperatingSystem]::IsWindows())">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
    <None Include="..\..\vendor\zstd.exe" Link="zstd.exe" Visible="false" Condition="$([System.OperatingSystem]::IsWindows())">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>
  
  <ItemGroup Label="NuGet">
    <None Include="Velopack.Build.targets" Pack="true" PackagePath="build\Velopack.Build.targets" />
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.Build.Utilities.Core" Version="17.9.5" />
  </ItemGroup>
</Project>
